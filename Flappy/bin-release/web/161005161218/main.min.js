var GameConst=function(){function t(){}var e=(__define,t);e.prototype;return t.START_X=288,t.BIRD_WIDTH=32,t.BIRD_HEIGHT=22,t.BIRD_START_X=50,t.BIRD_START_Y=150,t.TUBE_HEIGHT=320,t.TUBE_WIDTH=52,t.FLY_MAX=40,t.INIT_SPEED=5,t.GRAVITY=.5,t.MAX_ANGLE=50,t.STAGE_WIDTH=480,t.STAGE_HEIGHT=800,t.BG_WIDTH=288,t.BG_HEIGHT=384,t.TUBE_MIN_Y=120,t.TUBE_MAX_Y=270,t.GROUND_Y=350,t.MEDAL_SCORE_1=10,t.MEDAL_SCORE_2=30,t.MEDAL_SCORE_3=80,t}();egret.registerClass(GameConst,"GameConst");var GameEvent=function(t){function e(e,i,s,n){t.call(this,e,i,s,n)}__extends(e,t);var i=(__define,e);i.prototype;return e.GAME_START="GAME_START",e}(egret.Event);egret.registerClass(GameEvent,"GameEvent");var GameScene=function(t){function e(){t.call(this),this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this._tubes=[],this._isfly=!1,this.touchChildren=this.touchEnabled=!0,this._speed=GameConst.INIT_SPEED,this.mask=new egret.Rectangle(0,0,288,384),this._bglayer=new egret.Sprite,this._tubeLayer=new egret.Sprite,this._birdLayer=new egret.Sprite,this._groundLayer=new egret.Sprite,this._uiLayer=new egret.Sprite,this._startLayer=new egret.Sprite,this.addChild(this._bglayer),this.addChild(this._tubeLayer),this.addChild(this._birdLayer),this.addChild(this._groundLayer),this.addChild(this._uiLayer),this.addChild(this._startLayer),this._bg=new egret.Bitmap(RES.getRes("bg_png")),this._bglayer.addChild(this._bg),this._ground1=new egret.Bitmap(RES.getRes("ground_png")),this._groundLayer.addChild(this._ground1),this._ground2=new egret.Bitmap(RES.getRes("ground_png")),this._groundLayer.addChild(this._ground2),this._birdSp=new egret.Sprite,this._birdLayer.addChild(this._birdSp);var t=new egret.MovieClipDataFactory(RES.getRes("bird_json"),RES.getRes("bird_png"));this._bird=new egret.MovieClip(t.generateMovieClipData("bird")),this._birdSp.addChild(this._bird);var e=Math.floor(GameConst.BIRD_WIDTH/2),i=Math.floor(GameConst.BIRD_HEIGHT/2);this._bird.anchorOffsetX=e,this._bird.anchorOffsetY=i,this._bird.x=e,this._bird.y=i,this._scoreLabel=new egret.BitmapText,this._scoreLabel.font=RES.getRes("score1_fnt"),this._uiLayer.addChild(this._scoreLabel),this._lightImg=new egret.Bitmap(RES.getRes("white_png")),this._lightImg.width=GameConst.BG_WIDTH,this._lightImg.height=GameConst.BG_HEIGHT,this._uiLayer.addChild(this._lightImg),this._lightImg.alpha=0,this._startTitle=new egret.Bitmap(RES.getRes("text_ready_png")),this._startLayer.addChild(this._startTitle),this._startTitle.x=30,this._startTitle.y=50,this._startipImg=new egret.Bitmap(RES.getRes("tutorial_png")),this._startLayer.addChild(this._startipImg),this._startipImg.x=70,this._startipImg.y=120,this._resultView=new ResultView,this._uiLayer.addChild(this._resultView),this.resetGame()},s.resetGame=function(){for(this._resultView.visible=!1,this._scoreLabel.visible=!1,this._startLayer.visible=!0,this._ground1.x=0,this._ground1.y=GameConst.GROUND_Y,this._ground2.x=GameConst.BG_WIDTH,this._ground2.y=GameConst.GROUND_Y,this._birdSp.x=GameConst.BIRD_START_X,this._birdSp.y=GameConst.BIRD_START_Y,this._bird.play(-1),this._bird.rotation=0;this._tubes.length>0;){var t=this._tubes.pop();this._tubeLayer.removeChild(t)}this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onStartTap,this)},s.__onStartTap=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onStartTap,this),this.birdFly(),this.startGame()},s.startGame=function(){this._bird.stop(),this._score=0,this._scoreLabel.text=this._score+"",this._scoreLabel.x=this._scoreLabel.y=5,this._scoreLabel.visible=!0,this._startLayer.visible=!1,this._cupTube=this._cdownTube=null,this.createTubes(),this.addEvent()},s.createTubes=function(){this._cupTube=new egret.Bitmap(RES.getRes("tube1_png")),this._tubeLayer.addChild(this._cupTube),this._cupTube.y=Math.floor(-GameConst.TUBE_MIN_Y-Math.random()*(GameConst.TUBE_MAX_Y-GameConst.TUBE_MIN_Y)),this._cdownTube=new egret.Bitmap(RES.getRes("tube2_png")),this._tubeLayer.addChild(this._cdownTube),this._cdownTube.y=this._cupTube.y+430,this._cupTube.x=this._cdownTube.x=GameConst.START_X,this._tubes.push(this._cupTube),this._tubes.push(this._cdownTube)},s.addEvent=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.__onEnterframe,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onTouchTap,this)},s.removeEvent=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.__onEnterframe,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onTouchTap,this)},s.__onTouchTap=function(t){this.birdFly()},s.birdFly=function(){SoundManager.getInstance().playSound("sfx_wing_mp3"),this._speed=GameConst.INIT_SPEED,this._bird.gotoAndPlay(1,-1),this._isfly=!0;var t=egret.Tween.get(this._birdSp),e=this._birdSp.y-GameConst.FLY_MAX;0>e&&(e=0),t.to({y:e},300,egret.Ease.backOut).call(function(){this._isfly=!1,this._bird.stop()},this),egret.Tween.get(this._bird).to({rotation:-20},300)},s.__onEnterframe=function(t){for(var e=0;e<this._tubes.length;e++)this._tubes[e].x-=2,this._tubes[e].x<-GameConst.TUBE_WIDTH&&(this._tubeLayer.removeChild(this._tubes[e]),this._tubes.splice(e,1));this._ground1.x-=2,this._ground2.x-=2,this._ground1.x<=-GameConst.BG_WIDTH&&(this._ground1.x=GameConst.BG_WIDTH),this._ground2.x<=-GameConst.BG_WIDTH&&(this._ground2.x=GameConst.BG_WIDTH),this._isfly||(this._speed+=GameConst.GRAVITY,this._birdSp.y+=.5*this._speed,this._bird.rotation<GameConst.MAX_ANGLE&&(this._bird.rotation+=3),this._birdSp.y>=GameConst.GROUND_Y-GameConst.BIRD_HEIGHT&&(SoundManager.getInstance().playSound("sfx_hit_mp3"),this.gameOver())),this.checkCollision()},s.checkCollision=function(){if(this._cupTube.x<=this._birdSp.x+GameConst.BIRD_WIDTH&&this._cupTube.x+GameConst.TUBE_WIDTH>=this._birdSp.x){if(this._cupTube.y+GameConst.TUBE_HEIGHT>=this._birdSp.y)return SoundManager.getInstance().playSound("sfx_hit_mp3"),void this.gameOver();if(this._cdownTube.y<=this._birdSp.y+GameConst.BIRD_HEIGHT)return SoundManager.getInstance().playSound("sfx_hit_mp3"),void this.gameOver()}else this._cupTube.x+GameConst.TUBE_WIDTH<this._birdSp.x&&(SoundManager.getInstance().playSound("sfx_point_mp3"),this._cupTube=this._cdownTube=null,this._score++,this._scoreLabel.text=this._score+"",this.createTubes())},s.gameOver=function(){this.removeEvent(),egret.Tween.get(this._lightImg).to({alpha:1},200).to({alpha:0},200).call(function(){var t=this._birdSp.y,e=3*(GameConst.GROUND_Y-t);if(GameConst.GROUND_Y-t-GameConst.BIRD_HEIGHT>0){SoundManager.getInstance().playSound("sfx_die_mp3");var i=90*(1-(GameConst.GROUND_Y-t-GameConst.BIRD_HEIGHT)/GameConst.GROUND_Y);egret.Tween.get(this._bird).to({rotation:i},e),egret.Tween.get(this._birdSp).to({y:GameConst.GROUND_Y-GameConst.BIRD_HEIGHT},e).call(function(){this.showResult()},this)}else this.showResult()},this)},s.showResult=function(){SoundManager.getInstance().playSound("sfx_swooshing_mp3"),this._resultView.y=-126,this._resultView.visible=!0,this._resultView.showScore(this._score),egret.Tween.get(this._resultView).to({y:0},300,egret.Ease.backOut),this._resultView.addEventListener(GameEvent.GAME_START,this.__onStartGame,this)},s.__onStartGame=function(){this._resultView.removeEventListener(GameEvent.GAME_START,this.__onStartGame,this),egret.setTimeout(this.resetGame,this,100)},e}(egret.Sprite);egret.registerClass(GameScene,"GameScene");var GameUtil=function(){function t(){}var e=(__define,t);e.prototype;return t.removeFromParent=function(t){t&&t.parent&&t.parent.removeChild(t)},t}();egret.registerClass(GameUtil,"GameUtil");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},s.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.startGame())},s.startGame=function(){this._startScene=new StartScene,this.addChild(this._startScene),this._startScene.scaleX=this._startScene.scaleY=2.5,this._startScene.addEventListener(GameEvent.GAME_START,this.__onStartGame,this)},s.__onStartGame=function(t){this._startScene.removeEventListener(GameEvent.GAME_START,this.__onStartGame,this),this._startScene.dispose(),this.removeChild(this._startScene),this._gameScene=new GameScene,this.addChild(this._gameScene),this._gameScene.scaleX=this._gameScene.scaleY=2.5},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var ResultView=function(t){function e(){t.call(this),this.init(),this.addEvent()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this._title=new egret.Bitmap(RES.getRes("text_game_over_png")),this.addChild(this._title),this._title.x=27,this._title.y=50,this._bg=new egret.Bitmap(RES.getRes("score_panel_png")),this.addChild(this._bg),this._bg.x=10,this._bg.y=100,this._medal=new egret.Bitmap(RES.getRes("medals_0_png")),this.addChild(this._medal),this._medal.x=42,this._medal.y=145,this._score=new egret.BitmapText,this._score.font=RES.getRes("score2_fnt"),this.addChild(this._score),this._score.text="999",this._score.width=70,this._score.textAlign="center",this._score.x=163,this._score.y=140,this._startBtn=new egret.Bitmap(RES.getRes("button_play_png")),this.addChild(this._startBtn),this._startBtn.x=66,this._startBtn.y=230,this._startBtn.touchEnabled=!0},s.addEvent=function(){this._startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onStartTap,this)},s.removeEvent=function(){this._startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onStartTap,this)},s.__onStartTap=function(t){this.dispatchEventWith(GameEvent.GAME_START)},s.showScore=function(t){this._score.text=t+"",t>=GameConst.MEDAL_SCORE_3?this._medal.bitmapData=RES.getRes("medals_3_png"):t>=GameConst.MEDAL_SCORE_2?this._medal.bitmapData=RES.getRes("medals_2_png"):t>=GameConst.MEDAL_SCORE_1?this._medal.bitmapData=RES.getRes("medals_1_png"):this._medal.bitmapData=RES.getRes("medals_0_png")},e}(egret.Sprite);egret.registerClass(ResultView,"ResultView");var SoundManager=function(){function t(){this._sounds={}}var e=(__define,t),i=e.prototype;return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},i.playSound=function(t){if(this._sounds[t])this._sounds[t].play(0,1);else{var e=RES.getRes(t);e&&(e.play(0,1),this._sounds[t]=e)}},t}();egret.registerClass(SoundManager,"SoundManager");var StartScene=function(t){function e(){t.call(this),this.init(),this.addEvent()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.mask=new egret.Rectangle(0,0,288,384),this._bg=new egret.Bitmap(RES.getRes("bg_png")),this.addChild(this._bg),this._title=new egret.Bitmap(RES.getRes("title_png")),this.addChild(this._title),this._title.x=35,this._title.y=80,this._ground1=new egret.Bitmap(RES.getRes("ground_png")),this.addChild(this._ground1),this._ground1.y=GameConst.GROUND_Y,this._start=new egret.Bitmap(RES.getRes("button_play_png")),this.addChild(this._start),this._start.x=66,this._start.y=200,this._start.touchEnabled=!0;var t=new egret.MovieClipDataFactory(RES.getRes("bird_json"),RES.getRes("bird_png"));this._bird=new egret.MovieClip(t.generateMovieClipData("bird")),this.addChild(this._bird),this._bird.play(-1),this._bird.x=105,this._bird.y=150},s.addEvent=function(){this._start.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onStart,this)},s.removeEvent=function(){this._start.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onStart,this)},s.__onStart=function(t){this.dispatchEventWith(GameEvent.GAME_START)},s.dispose=function(){this.removeEvent(),this._bird.stop()},e}(egret.Sprite);egret.registerClass(StartScene,"StartScene");