var AssetAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",e),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},n.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},n.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},n.startCreateScene=function(){var t=new eui.Button;t.label="Click!",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this)},n.onButtonClick=function(t){var e=t.target;e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this),this.removeChild(e),this._editorScene=new EditorScene,this.addChild(this._editorScene),this._editorScene.addEventListener("runGame",this.__onRunGame,this)},n.__onRunGame=function(t){this._gameScene=new GameScene,this.addChild(this._gameScene),this._editorScene.visible=!1},e}(eui.UILayer);egret.registerClass(Main,"Main");var GameData=function(){function t(){this.col=16,this.row=12,this.tileWidth=40,this.tileHeight=40,this.lineColor=16711680,this.mapData=[[]]}var e=(__define,t);e.prototype;return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t}();egret.registerClass(GameData,"GameData");var ThemeAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var ArgsWindow=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(ArgsWindow,"ArgsWindow");var EditorScene=function(t){function e(){t.call(this),this.skinName=EditorSceneSkin}__extends(e,t);var i=(__define,e),n=i.prototype;return n.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},n.init=function(){this._tileVect=[],this._type=1;var t,e,i,n=GameData.getInstance().col,s=GameData.getInstance().row;for(t=0;n>t;t++)for(e=0;s>e;e++)i=new Tile(0,e,t,!0),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onTileTap,this),this.group_tile.addChild(i),i.x=GameData.getInstance().tileWidth*e,i.y=GameData.getInstance().tileHeight*t,this._tileVect.push(i);this.icon_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onIconTap,this),this.icon_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onIconTap,this),this.icon_3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onIconTap,this),this.icon_4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onIconTap,this),this.icon_5.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onIconTap,this),this.icon_6.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onIconTap,this),this.icon_7.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onIconTap,this),this.icon_8.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onIconTap,this),this.icon_9.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onIconTap,this),this.btn_mode.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onModeTap,this),this.btn_save.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onSaveTap,this),this.btn_clear.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onClearTap,this),this.btn_run.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onRunTap,this)},n.__onModeTap=function(t){this.group_icon.visible?(this.group_icon.visible=!1,this._type=-1):(this.group_icon.visible=!0,this._type=1),this.clearTiles()},n.__onSaveTap=function(t){this.saveMapData();var e={};e.mapData=GameData.getInstance().mapData,e.col=GameData.getInstance().col,e.row=GameData.getInstance().row,e.tileWidth=GameData.getInstance().tileWidth,e.tileHeight=GameData.getInstance().tileHeight,e.lineColor=GameData.getInstance().lineColor;var i=JSON.stringify(e),n=new Blob([i],{type:"text/plain;charset=utf-8"}),s="lianliankan.json",a=!0;saveAs(n,s,a)},n.saveMapData=function(){var t,e=this._tileVect.length;for(t=0;e>t;t++)GameData.getInstance().mapData[this._tileVect[t].row]||(GameData.getInstance().mapData[this._tileVect[t].row]=[]),GameData.getInstance().mapData[this._tileVect[t].row][this._tileVect[t].col]=this._tileVect[t].type},n.__onClearTap=function(t){this.clearTiles()},n.clearTiles=function(){var t,e=this._tileVect.length;for(t=0;e>t;t++)this._tileVect[t].type=0},n.__onRunTap=function(t){this.saveMapData(),this.dispatchEventWith("runGame")},n.__onTileTap=function(t){var e=t.currentTarget;e.type=e.type==this._type?0:this._type},n.__onIconTap=function(t){switch(t.target){case this.icon_1:this._type=1;break;case this.icon_2:this._type=2;break;case this.icon_3:this._type=3;break;case this.icon_4:this._type=4;break;case this.icon_5:this._type=5;break;case this.icon_6:this._type=6;break;case this.icon_7:this._type=7;break;case this.icon_8:this._type=8;break;case this.icon_9:this._type=9}},e}(eui.Component);egret.registerClass(EditorScene,"EditorScene");var GameScene=function(t){function e(){t.call(this),this.initData(),this.init()}__extends(e,t);var i=__define,n=e,s=n.prototype;return s.init=function(){var t,e,i,n=GameData.getInstance().col,s=GameData.getInstance().row;for(t=0;n>t;t++)for(e=0;s>e;e++)i=new Tile(GameData.getInstance().mapData[t][e],e,t),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onTileTap,this),this.addChild(i),i.x=GameData.getInstance().tileWidth*e,i.y=GameData.getInstance().tileHeight*t},s.__onTileTap=function(t){var e=t.currentTarget;if(0!=this.mapData[e.row][e.col]&&(null==this._atile?this._atile=t.currentTarget:null==this._btile&&(this._btile=t.currentTarget),null!=this._atile&&null!=this._btile)){if(this._atile.type==this._btile.type){var i,n=this.horizon(new egret.Point(this._atile.col,this._atile.row),new egret.Point(this._btile.col,this._btile.row)),s=this.vertical(new egret.Point(this._atile.col,this._atile.row),new egret.Point(this._btile.col,this._btile.row)),a=this.oneCorner(new egret.Point(this._atile.col,this._atile.row),new egret.Point(this._btile.col,this._btile.row)),r=this.twoCorner(new egret.Point(this._atile.col,this._atile.row),new egret.Point(this._btile.col,this._btile.row));n?(console.log("---------横向消除"),this.removeTile(this.drawLines([n]),this._atile,this._btile),this._atile=this._btile=null):s?(console.log("---------竖向消除"),this.removeTile(this.drawLines([s]),this._atile,this._btile),this._atile=this._btile=null):a.length>0?(console.log("---------单转角消除"),this.removeTile(this.drawLines(a),this._atile,this._btile),this._atile=this._btile=null):r.length>0?(console.log("---------双转角消除"),this.removeTile(this.drawLines(r),this._atile,this._btile),this._atile=this._btile=null):(console.log("---------选择的两个消除不了"),this._atile=this._btile=null)}else console.log("---------选择的两个消除不了"),this._atile=this._btile=null;i&&this.addChild(i)}},s.horizon=function(t,e){if(t.x==e.x&&t.y==e.y)return null;if(t.y!=e.y)return null;for(var i=t.x<e.x?t.x:e.x,n=t.x<e.x?e.x:t.x,s=i+1;n>s;s++)if(0!=this.mapData[t.y][s])return null;return new Line(new egret.Point(t.x,t.y),new egret.Point(e.x,e.y),1)},s.vertical=function(t,e){if(t.x==e.x&&t.y==e.y)return null;if(t.x!=e.x)return null;for(var i=t.y<e.y?t.y:e.y,n=t.y<e.y?e.y:t.y,s=i+1;n>s;s++)if(0!=this.mapData[s][t.x])return null;return new Line(new egret.Point(t.x,t.y),new egret.Point(e.x,e.y),0)},s.oneCorner=function(t,e){var i,n=new egret.Point(e.x,t.y),s=new egret.Point(t.x,e.y),a=this.horizon(e,n),r=this.vertical(t,n),o=this.horizon(e,n),h=this.vertical(e,n);i=0==this.mapData[n.y][n.x]&&a&&h?[a,h]:0==this.mapData[n.y][n.x]&&o&&r?[o,r]:[];var l=this.horizon(t,s),c=this.vertical(t,s),_=this.horizon(e,s),d=this.vertical(e,s);return i=0==this.mapData[s.y][s.x]&&l&&d?[l,d]:0==this.mapData[s.y][s.x]&&_&&c?[_,c]:[]},s.scan=function(t,e){this.linkList=[];for(var i,n=t.x;n>=0;n--)i=this.vertical(new egret.Point(n,t.x),new egret.Point(n,e.y)),0==this.mapData[t.y][n]&&0==this.mapData[e.y][n]&&i&&this.linkList.push(i);for(n=t.x;n<this.col;n++)i=this.vertical(new egret.Point(n,t.y),new egret.Point(n,e.y)),0==this.mapData[t.y][n]&&0==this.mapData[e.y][n]&&i&&this.linkList.push(i);for(var s=t.y;s>=0;s--)i=this.horizon(new egret.Point(t.x,s),new egret.Point(e.x,s)),0==this.mapData[s][t.x]&&0==this.mapData[s][e.x]&&i&&this.linkList.push(i);for(s=t.y;s<this.row;s++)i=this.horizon(new egret.Point(t.x,s),new egret.Point(e.x,s)),0==this.mapData[s][t.x]&&0==this.mapData[s][e.x]&&i&&this.linkList.push(i);return this.linkList},s.twoCorner=function(t,e){var i=this.scan(t,e);if(0==i.length)return[];for(var n,s,a=0;a<i.length;a++){var r=i[a];if(1==r.direct){if(n=this.vertical(e,r.b),s=this.vertical(r.a,t),n&&s)return[n,r,s]}else if(0==r.direct&&(n=this.horizon(t,r.a),s=this.horizon(r.b,e),n&&s))return[n,r,s]}return[]},s.initData=function(){this.mapData=GameData.getInstance().mapData,this.col=GameData.getInstance().col,this.row=GameData.getInstance().row},s.drawLines=function(t){var e,i=t.length,n=new egret.Shape;for(n.graphics.lineStyle(5,GameData.getInstance().lineColor),n.graphics.moveTo(this.getWidthByPos(t[0].a.x),this.getHeightByPos(t[0].a.y)),e=0;i>e;e++)n.graphics.lineTo(this.getWidthByPos(t[e].a.x),this.getHeightByPos(t[e].a.y)),n.graphics.lineTo(this.getWidthByPos(t[e].b.x),this.getHeightByPos(t[e].b.y));return n.graphics.endFill(),n},s.removeTile=function(t,e,i){this.addChild(t),this.twRemoveObj(this._atile),this.twRemoveObj(this._btile),this.twRemoveObj(t),GameData.getInstance().mapData[this._atile.row][this._atile.col]=0,GameData.getInstance().mapData[this._btile.row][this._btile.col]=0},s.twRemoveObj=function(t){var e=egret.Tween.get(t);e.to({alpha:0},500).call(function(){this.removeChild(t)}.bind(this))},s.getWidthByPos=function(t){return t*GameData.getInstance().tileWidth+GameData.getInstance().tileWidth/2},s.getHeightByPos=function(t){return t*GameData.getInstance().tileHeight+GameData.getInstance().tileHeight/2},i(s,"mapData",function(){return GameData.getInstance().mapData}),e}(egret.Sprite);egret.registerClass(GameScene,"GameScene");var Line=function(t){function e(e,i,n){this.a=e,this.b=i,this.direct=n,t.call(this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.Sprite);egret.registerClass(Line,"Line");var Tile=function(t){function e(e,i,n,s){void 0===s&&(s=!1),t.call(this),this._type=e,this.col=i,this.row=n,(s||0!=this._type)&&(this._bp=new egret.Bitmap(RES.getRes("icon_"+this.type+"_png")),this.addChild(this._bp),this._bp.width=GameData.getInstance().tileWidth,this._bp.height=GameData.getInstance().tileHeight,this._bp.touchEnabled=!0),this.touchChildren=this.touchEnabled=!0}__extends(e,t);var i=__define,n=e,s=n.prototype;return i(s,"type",function(){return this._type},function(t){this._type=t,this._bp.texture=RES.getRes("icon_"+this.type+"_png")}),e}(egret.Sprite);egret.registerClass(Tile,"Tile");