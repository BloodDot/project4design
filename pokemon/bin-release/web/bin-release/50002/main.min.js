var AnchorUtil=function(){function t(){}var e=(__define,t);e.prototype;return t.init=function(){this._isInited||(this._propertyChange=Object.create(null),this._anchorChange=Object.create(null),this.injectAnchor(),this._isInited=!0)},t.setAnchorX=function(t,e){t.anchorX=e},t.setAnchorY=function(t,e){t.anchorY=e},t.setAnchor=function(t,e){t.anchorX=t.anchorY=e},t.getAnchorX=function(t){return t.anchorX||0},t.getAnchorY=function(t){return t.anchorY||0},t.injectAnchor=function(){Object.defineProperty(egret.DisplayObject.prototype,"width",{get:function(){return this.$getWidth()},set:function(e){var i=this;this.$setWidth(e),t._propertyChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"height",{get:function(){return this.$getHeight()},set:function(e){var i=this;this.$setHeight(e),t._propertyChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorX",{get:function(){return this._anchorX},set:function(e){var i=this;this._anchorX=e,t._propertyChange[this.hashCode]=!0,t._anchorChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorY",{get:function(){return this._anchorY},set:function(e){var i=this;this._anchorY=e,t._propertyChange[this.hashCode]=!0,t._anchorChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchor",{get:function(){return this._anchorX},set:function(e){var i=this;this._anchorX=e,this._anchorY=e,t._propertyChange[this.hashCode]=!0,t._anchorChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0})},t.changeAnchor=function(e){t._propertyChange[e.hashCode]&&t._anchorChange[e.hashCode]&&(e.anchorOffsetX=e._anchorX*e.width,e.anchorOffsetY=e._anchorY*e.height,delete t._propertyChange[e.hashCode])},t}();egret.registerClass(AnchorUtil,"AnchorUtil");var ArrayUtil=function(){function t(){}var e=(__define,t);e.prototype;return t.getDifferentInAB=function(t,e){for(var i,n=[],s=0;s<t.length;s++){for(var o=0;o<e.length;o++){if(t[s]==e[o]){i=1;break}i=0}0==i&&n.push(t[s])}return n},t.sortByProperty=function(t,e,i){return void 0===i&&(i=!0),t.sort(function(t,e){return t.tproperty>e.tproperty?i?-1:1:i?1:-1}),t},t.getElementByProperty=function(t,e,i){var n,s=t.length;for(n=0;s>n;n++)if(t[n][e]==i)return t[n]},t.replaceElement=function(t,e,i){this.hasElement(t,i)&&(t[t.indexOf(i)]=e)},t.removeIndex=function(t,e){return t.splice(e,1)},t.hasElement=function(t,e){return-1==t.indexOf(e)?!1:!0},t.removeElement=function(t,e){return t.splice(t.indexOf(e),1)},t.addElement=function(t,e,i){void 0===i&&(i=!0),i?this.hasElement(t,e)||t.push(e):t.push(e)},t.CSVToArray=function(t,e){void 0===e&&(e=void 0),e=e||",";for(var i=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),n=[[]],s=[{}],o=0,r=0,a=null;a=i.exec(t);){var h=a[1];if(h.length&&h!=e&&(3>o?(n.push([]),o++):(s.push({}),r=0)),a[2])var l=a[2].replace(new RegExp('""',"g"),'"');else var l=a[3];l=l.replace(/\s+/g,""),3>o?n[n.length-1].push(l):("number"==n[2][r]&&(l=""==l?0:parseFloat(l)),s[s.length-1][n[1][r]]=l,r++)}return s.pop(),s},t}();egret.registerClass(ArrayUtil,"ArrayUtil");var AssetAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var AnimeManager=function(){function t(){}var e=(__define,t),i=e.prototype;return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},i.playAtk=function(t,e,i,n,s,o,r){this._aft=t,this._bft=e,this._cell=i,this._func=n,this._args=s,this._isown=o,this._ox=this._aft.x,this._oy=this._aft.y,this._parent=r;var a=egret.Tween.get(this._aft);a.to({scaleX:2.5,scaleY:2.5},100).to({scaleX:2,scaleY:2},100).call(this.startPlay,this)},i.startPlay=function(){switch(this._cell.type){case 1:this.playMc(this._bft);break;case 4:this.playMc(this._aft);break;case 2:this.ftCome();break;case 3:this.flyBall()}},i.ftCome=function(){var t=egret.Tween.get(this._aft),e=this._bft.x,i=this._bft.y;t.to({x:e,y:i},300).call(this.playMc,this,[this._aft,this.ftBack.bind(this)])},i.ftBack=function(){var t=egret.Tween.get(this._aft);t.to({x:this._ox,y:this._oy},300).call(function(){this._func(this._args)},this)},i.flyBall=function(){var t=new eui.Image(this.getBallresBySeries(this._cell.series));this._parent.addChild(t),t.x=this._aft.x,t.y=this._aft.y;var e=egret.Tween.get(t);e.to({x:this._bft.x+this._bft.width/2,y:this._bft.y+this._bft.height/2},300).call(this.playMc,this,[this._bft,null,t])},i.playMc=function(t,e,i){i&&this._parent.removeChild(i);var n=new ZMovieClip;n.loadByLocal(RES.getRes(this._cell.resId+"_json"),RES.getRes(this._cell.resId+"_png"),this._cell.resId),n.x=t.x-n.width/2+this._aft.width/2*this._aft.scaleX,n.y=t.y-n.height/2+this._aft.height/2*this._aft.scaleY,n.back=e,this._parent.addChild(n),n.addEventListener(egret.Event.COMPLETE,this.__onMcComplete,this),n.play()},i.__onMcComplete=function(t){var e=t.target;this._parent.removeChild(e),e.removeEventListener(egret.Event.COMPLETE,this.__onMcComplete,this),e.back?e.back():this._func(this._args)},i.getBallresBySeries=function(t){var e="ft_effect_light_png";switch(t){case 3:case 7:case 16:e="ft_effect_dark_png";break;case 9:e="ft_effect_fire_png";break;case 10:case 14:e="ft_effect_water_png";break;case 11:case 6:e="ft_effect_wood_png"}return e},t}();egret.registerClass(AnimeManager,"AnimeManager");var BattleScene=function(t){function e(){t.call(this),this.skinName=BattleSceneSkin}__extends(e,t);var i=__define,n=e,s=n.prototype;return s.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._isCreated=!0,this.group_desc.visible=!1,this.group_operate.visible=!0,this.updateInfo(),this.addEvent()},s.addEvent=function(){this.btn_skill1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onSkillTap,this),this.btn_skill2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onSkillTap,this),this.btn_skill3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onSkillTap,this),this.btn_skill4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onSkillTap,this)},s.removeEvent=function(){this.btn_skill1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onSkillTap,this),this.btn_skill2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onSkillTap,this),this.btn_skill3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onSkillTap,this),this.btn_skill4.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onSkillTap,this)},s.__onSkillTap=function(t){var e=t.target.cell;this.skillStart(this._ownFtvo,this._enemyFtvo,e)},i(s,"ownObj",void 0,function(t){this._ownObj=t,this.updateInfo()}),i(s,"enemyObj",void 0,function(t){this._enemyObj=t,this.updateInfo()}),s.updateInfo=function(){this._ownObj&&this._enemyObj&&this._isCreated&&(this._ownFtvo=new FighterVO,this._ownFtvo.side=1,this._enemyFtvo=new FighterVO,this._enemyFtvo.side=2,this.label_own_cur_hp.text=this.label_own_max_hp.text=""+FightConst.MAX_HP,this._ownObj[1]?this.btn_skill1.cell=this._ownObj[1]:this.btn_skill1.visible=!1,this._ownObj[2]?this.btn_skill2.cell=this._ownObj[2]:this.btn_skill2.visible=!1,this._ownObj[3]?this.btn_skill3.cell=this._ownObj[3]:this.btn_skill3.visible=!1,this._ownObj[4]?this.btn_skill4.cell=this._ownObj[4]:this.btn_skill4.visible=!1,this.img_own_monster.source=this._ownObj.id+"_back_png",this.img_enemy_monster.source=this._enemyObj.id+"_front_png",this._isOwnRound=!0,SoundManager.getInstance().playBattleSound())},s.skillStart=function(t,e,i){var n=this.getFtByVO(t),s=this.getFtByVO(e);this.group_desc.visible=!0,this.group_operate.visible=!1;var o="";this._isOwnRound?(o="我方使用"+i.name+"对敌方造成"+i.damage+"伤害",this._enemyFtvo.hp-=i.damage):(o="敌方使用"+i.name+"对我方造成"+i.damage+"伤害",this._ownFtvo.hp-=i.damage),this.label_desc.text=o,AnimeManager.getInstance().playAtk(n,s,i,this.updateBar.bind(this),i,this._isOwnRound,this)},s.updateBar=function(t){this._isOwnRound?this.bar_enemy_hp.value=100*this._enemyFtvo.hp/FightConst.MAX_HP:(this.bar_own_hp.value=100*this._ownFtvo.hp/FightConst.MAX_HP,this.label_own_cur_hp.text=""+this._ownFtvo.hp),egret.setTimeout(this.skillEnd,this,500)},s.skillEnd=function(){return this._ownFtvo.hp<=0?void this.dispatchEventWith("lose",!0):this._enemyFtvo.hp<=0?void this.dispatchEventWith("win",!0):(this.label_desc.text="",this._isOwnRound=!this._isOwnRound,void(this._isOwnRound?(this.group_desc.visible=!1,this.group_operate.visible=!0):this.skillStart(this._enemyFtvo,this._ownFtvo,this.getRandomEnmeySkill())))},s.getFtByVO=function(t){return 1==t.side?this.img_own_monster:this.img_enemy_monster},s.getRandomEnmeySkill=function(){var t=[];this._enemyObj[1]&&t.push(this._enemyObj[1]),this._enemyObj[2]&&t.push(this._enemyObj[2]),this._enemyObj[3]&&t.push(this._enemyObj[3]),this._enemyObj[4]&&t.push(this._enemyObj[4]);var e=Math.round(Math.random()*(t.length-1));return t[e]},e}(eui.Component);egret.registerClass(BattleScene,"BattleScene");var BattleSkillButton=function(t){function e(){t.call(this)}__extends(e,t);var i=__define,n=e,s=n.prototype;return i(s,"normal",function(){return this.normalDisplay?this.normalDisplay.source:this._normal},function(t){this._normal=t,this.normalDisplay&&(this.normalDisplay.source=t)}),i(s,"down",function(){return this.downDisplay?this.downDisplay.source:this._down},function(t){this._down=t,this.downDisplay&&(this.downDisplay.source=t)}),s.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i),i==this.normalDisplay&&void 0!=this._normal&&(this.normalDisplay.source=this._normal),i==this.downDisplay&&void 0!=this._down&&(this.downDisplay.source=this._down)},i(s,"cell",function(){return this._cell},function(t){t!=this._cell&&(this._cell=t,this.normalDisplay.source=this._cell.series+"D_png",this.downDisplay.source=this._cell.series+"H_png",this.label=this.cell.name)}),e}(eui.Button);egret.registerClass(BattleSkillButton,"BattleSkillButton");var FightConst=function(){function t(){}var e=(__define,t);e.prototype;return t.MAX_HP=1e3,t}();egret.registerClass(FightConst,"FightConst");var FighterVO=function(){function t(){this.hp=FightConst.MAX_HP}var e=(__define,t);e.prototype;return t}();egret.registerClass(FighterVO,"FighterVO");var ResultScene=function(t){function e(){t.call(this),this.skinName=ResultSceneSkin}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(ResultScene,"ResultScene");var SoundManager=function(){function t(){}var e=(__define,t),i=e.prototype;return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},i.playOpenSound=function(){this._openSound=RES.getRes("open_mp3"),this._bgChannel=this._openSound.play()},i.stopOpenSound=function(){this._bgChannel.stop()},i.playBattleSound=function(){this._battleSound=RES.getRes("battle_mp3"),this._bgChannel=this._battleSound.play()},i.stopBattleSound=function(){this._bgChannel.stop()},i.playWinSound=function(){this._winSound=RES.getRes("win_mp3"),this._bgChannel=this._winSound.play()},i.stopWinSound=function(){this._bgChannel.stop()},t}();egret.registerClass(SoundManager,"SoundManager");var SkillCell=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(SkillCell,"SkillCell");var SkillTable=function(){function t(){}var e=__define,i=t,n=i.prototype;return t.getInstance=function(){return void 0==this._instance&&(this._instance=new t),this._instance},n.analysis=function(t){this._vect=t},n.getCellById=function(t){var e,i=this._vect.length;for(e=0;i>e;e++)if(this._vect[e].id==t)return this._vect[e]},e(n,"vect",function(){return this._vect}),t}();egret.registerClass(SkillTable,"SkillTable");var GameEditorScene=function(t){function e(){t.call(this),this.skinName=GameEditorSceneSkin}__extends(e,t);var i=__define,n=e,s=n.prototype;return s.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._ownSkobj={},this._enemySkobj={},this.addEvent()},s.addEvent=function(){this.txt_own.addEventListener(egret.TextEvent.CHANGE,this.__onOwnTxtChange,this),this.txt_enemy.addEventListener(egret.TextEvent.CHANGE,this.__onEnemyTxtChange,this),this.btn_own_skill1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onOwnSkillTap,this),this.btn_own_skill2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onOwnSkillTap,this),this.btn_own_skill3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onOwnSkillTap,this),this.btn_own_skill4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onOwnSkillTap,this),this.btn_enemy_skill1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onEnemySkillTap,this),this.btn_enemy_skill2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onEnemySkillTap,this),this.btn_enemy_skill3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onEnemySkillTap,this),this.btn_enemy_skill4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onEnemySkillTap,this),this.btn_battle.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onBattleTap,this),this.addEventListener("skillSelect",this.__onSkillSelect,this)},s.removeEvent=function(){this.txt_own.removeEventListener(egret.TextEvent.CHANGE,this.__onOwnTxtChange,this),this.txt_enemy.removeEventListener(egret.TextEvent.CHANGE,this.__onEnemyTxtChange,this),this.btn_own_skill1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onOwnSkillTap,this),this.btn_own_skill2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onOwnSkillTap,this),this.btn_own_skill3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onOwnSkillTap,this),this.btn_own_skill4.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onOwnSkillTap,this),this.btn_enemy_skill1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onEnemySkillTap,this),this.btn_enemy_skill2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onEnemySkillTap,this),this.btn_enemy_skill3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onEnemySkillTap,this),this.btn_enemy_skill4.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onEnemySkillTap,this),this.btn_battle.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onBattleTap,this),this.removeEventListener("skillSelect",this.__onSkillSelect,this)},s.__onBattleTap=function(t){""!=this.txt_own.text&&""!=this.txt_enemy.text&&(this._ownSkobj[1]||this._ownSkobj[2]||this._ownSkobj[3]||this._ownSkobj[4])&&(this._enemySkobj[1]||this._enemySkobj[2]||this._enemySkobj[3]||this._enemySkobj[4])&&this.dispatchEventWith("startBattle",!0)},s.__onSkillSelect=function(t){var e=t.data;switch(this._curSkill){case this.btn_own_skill1:this._ownSkobj[1]=e;break;case this.btn_own_skill2:this._ownSkobj[2]=e;break;case this.btn_own_skill3:this._ownSkobj[3]=e;break;case this.btn_own_skill4:this._ownSkobj[4]=e;break;case this.btn_enemy_skill1:this._enemySkobj[1]=e;break;case this.btn_enemy_skill2:this._enemySkobj[2]=e;break;case this.btn_enemy_skill3:this._enemySkobj[3]=e;break;case this.btn_enemy_skill4:this._enemySkobj[4]=e}this._curSkill.cell=e,this.list_skill.visible=!1},s.__onOwnSkillTap=function(t){this._curSkill=t.target,this.list_skill.visible=!0},s.__onEnemySkillTap=function(t){this._curSkill=t.target,this.list_skill.visible=!0},s.__onOwnTxtChange=function(t){var e=parseInt(this.txt_own.text);""==this.txt_own.text?e=0:e>649&&(e=649,this.txt_own.text="649"),this._ownSkobj.id=e,this.image_own_monster.source=e+"_png"},s.__onEnemyTxtChange=function(t){var e=parseInt(this.txt_enemy.text);""==this.txt_enemy.text?e=0:e>649&&(e=649,this.txt_enemy.text="649"),this._enemySkobj.id=e,this.image_enemy_monster.source=e+"_png"},i(s,"ownSkobj",function(){return this._ownSkobj}),i(s,"enemySkobj",function(){return this._enemySkobj}),s.dispose=function(){this.removeEvent()},e}(eui.Component);egret.registerClass(GameEditorScene,"GameEditorScene");var GameSkillItem=function(t){function e(){t.call(this),this.skinName=GameSkillItemSkin}__extends(e,t);var i=(__define,e),n=i.prototype;return n.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._created=!0,this.updateInfo(),this.addEvent()},n.addEvent=function(){this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__confirmTap,this)},n.removeEvent=function(){this.btn_confirm.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__confirmTap,this)},n.__confirmTap=function(t){this.dispatchEventWith("skillSelect",!0,this.data)},n.dataChanged=function(){t.prototype.dataChanged.call(this),this.updateInfo()},n.updateInfo=function(){if(this.data&&this._created){var t=this.data;this.txt_id.text=""+t.id,this.txt_name.text=t.name,this.txt_damage.text="伤害值:"+t.damage,this.txt_type.text=this.getTypeName(t.type),this.txt_series.text=this.getSeriesName(t.series)}},n.getTypeName=function(t){var e="";switch(t){case 1:e="远程直接攻击";break;case 2:e="近战跑过去攻击";break;case 3:e="抛东西攻击";break;case 4:e="自身加状态"}return e},n.getSeriesName=function(t){var e="";switch(t){case 0:e="普通";break;case 1:e="格斗";break;case 2:e="飞行";break;case 3:e="毒";break;case 4:e="地面";break;case 5:e="岩石";break;case 6:e="虫";break;case 7:e="鬼";break;case 8:e="钢";break;case 9:e="火";break;case 10:e="水";break;case 11:e="草";break;case 12:e="电";break;case 13:e="超能";break;case 14:e="冰";break;case 15:e="龙";break;case 16:e="暗"}return e},e}(eui.ItemRenderer);egret.registerClass(GameSkillItem,"GameSkillItem");var GameSkillList=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=SkillTable.getInstance().vect,i=new eui.VerticalLayout;i.gap=6,this._skillList=new eui.List,this._skillList.useVirtualLayout=!0,this._skillList.layout=i,this._skillList.itemRenderer=GameSkillItem,this._skillList.dataProvider=new eui.ArrayCollection(e),this._skillList.selectedIndex=1,this.scroller_skill.viewport=this._skillList},e}(eui.Component);egret.registerClass(GameSkillList,"GameSkillList");var SkillEditorScene=function(t){function e(){t.call(this),this.skinName=SkillEditorSceneSkin}__extends(e,t);var i=(__define,e),n=i.prototype;return n.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._mc=new ZMovieClip,this.addChild(this._mc),this._mc.x=100,this._mc.y=100,this.addEvent()},n.addEvent=function(){this.btn_play.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onPlayTap,this),this.btn_stop.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__onStopTap,this)},n.removeEvent=function(){this.btn_play.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onPlayTap,this),this.btn_stop.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__onStopTap,this)},n.__onPlayTap=function(t){if(""!=this.txt_input_skill.text){var e=this.txt_input_skill.text;this._mc.loadByUrl(e+"_json",e+"_png",e)}this._mc.play(-1)},n.__onStopTap=function(t){this._mc.stop()},n.dispose=function(){this.removeEvent()},e}(eui.Component);egret.registerClass(SkillEditorScene,"SkillEditorScene");var ZMovieClip=function(t){function e(){t.call(this),this._isDisposed=!1,this._zplayTimes=0}__extends(e,t);var i=__define,n=e,s=n.prototype;return s.loadByUrl=function(t,e,i){var n=this;n._configName=t,n._sourceName=e,n._mcName=i,RES.hasRes(t)&&RES.hasRes(e)?(RES.getResAsync(t,n.onConfigComplete,n),RES.getResAsync(e,n.onSourceComplete,n)):(RES.getResByUrl(t,n.onConfigComplete,n),RES.getResByUrl(e,n.onSourceComplete,n))},s.loadByLocal=function(t,e,i){this._mcName=i,this.onConfigComplete(t),this.onSourceComplete(e)},s.onConfigComplete=function(t){this._configData=t,void 0!=this._sourceData&&this.createMc()},s.onSourceComplete=function(t){this._sourceData=t,void 0!=this._configData&&this.createMc()},s.createMc=function(){var t=new egret.MovieClipDataFactory(this._configData,this._sourceData);this.movieClipData=t.generateMovieClipData(this._mcName),void 0!=this._zframeRate&&(this.frameRate=this._zframeRate),0!=this._zplayTimes&&this.play(this._zplayTimes)},s.play=function(e){void 0===e&&(e=0),this._zplayTimes=e,this.movieClipData&&t.prototype.play.call(this,this._zplayTimes)},i(s,"zframeRate",void 0,function(t){this._zframeRate=t,this.movieClipData&&(this.frameRate=this._zframeRate)}),s.clearData=function(){this._configData=void 0,this._sourceData=void 0},s.dispose=function(t){void 0===t&&(t=!0),this._isDisposed||(this._isDisposed=!0,this.stop(),this._configData=null,this._sourceData=null,t&&(RES.destroyRes(this._configName),RES.destroyRes(this._sourceName)))},e}(egret.MovieClip);egret.registerClass(ZMovieClip,"ZMovieClip");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",e),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.loadSkillConfig())},n.loadSkillConfig=function(){var t=new egret.URLLoader;t.addEventListener(egret.Event.COMPLETE,this.__onSkillConfigComplete,this),t.load(new egret.URLRequest("resource/config/skill.csv"))},n.__onSkillConfigComplete=function(t){t.target.removeEventListener(egret.Event.COMPLETE,this.__onSkillConfigComplete,this);var e=ArrayUtil.CSVToArray(t.target.data);SkillTable.getInstance().analysis(e),this.createScene()},n.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},n.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},n.startCreateScene=function(){var t=new GameEditorScene;this.addChild(t),SoundManager.getInstance().playOpenSound(),t.addEventListener("startBattle",this.__startBattle,this)},n.__startBattle=function(t){this._editor=t.target,this._editor.removeEventListener("startBattle",this.__startBattle,this),this._editor.visible=!1;var e=[];this._editor.ownSkobj[1]&&this.pushRes(e,this._editor.ownSkobj[1].resId),this._editor.ownSkobj[2]&&this.pushRes(e,this._editor.ownSkobj[2].resId),this._editor.ownSkobj[3]&&this.pushRes(e,this._editor.ownSkobj[3].resId),this._editor.ownSkobj[4]&&this.pushRes(e,this._editor.ownSkobj[4].resId),this._editor.enemySkobj[1]&&this.pushRes(e,this._editor.enemySkobj[1].resId),this._editor.enemySkobj[2]&&this.pushRes(e,this._editor.enemySkobj[2].resId),this._editor.enemySkobj[3]&&this.pushRes(e,this._editor.enemySkobj[3].resId),this._editor.enemySkobj[4]&&this.pushRes(e,this._editor.enemySkobj[4].resId),RES.createGroup("skill",e),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.__onSkillGroupComplete,this),RES.loadGroup("skill")},n.__onSkillGroupComplete=function(t){SoundManager.getInstance().stopOpenSound(),this._battle=new BattleScene,this._battle.ownObj=this._editor.ownSkobj,this._battle.enemyObj=this._editor.enemySkobj,this.addChild(this._battle),this._battle.addEventListener("win",this.__onWin,this),this._battle.addEventListener("lose",this.__onWin,this)},n.__onWin=function(t){this._battle.visible=!1,this._result=new ResultScene,this.addChild(this._result),this._result.label_result.text="战斗胜利",SoundManager.getInstance().stopBattleSound(),SoundManager.getInstance().playWinSound()},n.__onLose=function(t){this._battle.visible=!1,this._result=new ResultScene,this.addChild(this._result),this._result.label_result.text="战斗失败",SoundManager.getInstance().stopBattleSound()},n.pushRes=function(t,e){-1!=t.indexOf(e+"_png")&&t.push(e+"_png"),-1!=t.indexOf(e+"_json")&&t.push(e+"_json")},e}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);